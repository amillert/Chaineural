!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@swimlane/ngx-charts"),require("d3-selection"),require("d3-shape"),require("d3-ease"),require("d3-transition"),require("rxjs"),require("rxjs/operators"),require("transformation-matrix"),require("dagre"),require("d3-force"),require("webcola"),require("d3-dispatch"),require("d3-timer")):"function"==typeof define&&define.amd?define("@swimlane/ngx-graph",["exports","@angular/core","@swimlane/ngx-charts","d3-selection","d3-shape","d3-ease","d3-transition","rxjs","rxjs/operators","transformation-matrix","dagre","d3-force","webcola","d3-dispatch","d3-timer"],e):e(((t=t||self).swimlane=t.swimlane||{},t.swimlane["ngx-graph"]={}),t.ng.core,t.ngxCharts,t.d3Selection,t.d3Shape,t.d3Ease,null,t.rxjs,t.rxjs.operators,t.transformationMatrix,t.dagre,t.d3Force,t.webcola,t.d3Dispatch,t.d3Timer)}(this,function(t,e,n,i,o,r,s,a,d,h,u,p,g,c,l){"use strict";var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var m=function(){return(m=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function y(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r["return"])&&n.call(r)}finally{if(o)throw o.error}}return s}function x(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(v(arguments[e]));return t}var b={};function w(){var t=("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4);return b[t="a"+t]?w():(b[t]=!0,t)}var G={LEFT_TO_RIGHT:"LR",RIGHT_TO_LEFT:"RL",TOP_TO_BOTTOM:"TB",BOTTOM_TO_TOM:"BT"},T=function(){function t(){this.defaultSettings={orientation:G.LEFT_TO_RIGHT,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,multigraph:!0,compound:!0},this.settings={}}return t.prototype.run=function(t){this.createDagreGraph(t),u.layout(this.dagreGraph),t.edgeLabels=this.dagreGraph._edgeLabels;var e=function(e){var i=n.dagreGraph._nodes[e],o=t.nodes.find(function(t){return t.id===i.id});o.position={x:i.x,y:i.y},o.dimension={width:i.width,height:i.height}},n=this;for(var i in this.dagreGraph._nodes)e(i);return t},t.prototype.updateEdge=function(t,e){var n=t.nodes.find(function(t){return t.id===e.source}),i=t.nodes.find(function(t){return t.id===e.target}),o=n.position.y<=i.position.y?-1:1,r={x:n.position.x,y:n.position.y-o*(n.dimension.height/2)},s={x:i.position.x,y:i.position.y+o*(i.dimension.height/2)};return e.points=[r,s],t},t.prototype.createDagreGraph=function(t){var e,n,i,o,r=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new u.graphlib.Graph({compound:r.compound,multigraph:r.multigraph}),this.dagreGraph.setGraph({rankdir:r.orientation,marginx:r.marginX,marginy:r.marginY,edgesep:r.edgePadding,ranksep:r.rankPadding,nodesep:r.nodePadding,align:r.align,acyclicer:r.acyclicer,ranker:r.ranker,multigraph:r.multigraph,compound:r.compound}),this.dagreGraph.setDefaultEdgeLabel(function(){return{}}),this.dagreNodes=t.nodes.map(function(t){var e=Object.assign({},t);return e.width=t.dimension.width,e.height=t.dimension.height,e.x=t.position.x,e.y=t.position.y,e}),this.dagreEdges=t.edges.map(function(t){var e=Object.assign({},t);return e.id||(e.id=w()),e});try{for(var s=y(this.dagreNodes),a=s.next();!a.done;a=s.next()){var d=a.value;d.width||(d.width=20),d.height||(d.height=30),this.dagreGraph.setNode(d.id,d)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(n=s["return"])&&n.call(s)}finally{if(e)throw e.error}}try{for(var h=y(this.dagreEdges),p=h.next();!p.done;p=h.next()){var g=p.value;r.multigraph?this.dagreGraph.setEdge(g.source,g.target,g,g.id):this.dagreGraph.setEdge(g.source,g.target)}}catch(l){i={error:l}}finally{try{p&&!p.done&&(o=h["return"])&&o.call(h)}finally{if(i)throw i.error}}return this.dagreGraph},t}(),L=function(){function t(){this.defaultSettings={orientation:G.LEFT_TO_RIGHT,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,multigraph:!0,compound:!0},this.settings={}}return t.prototype.run=function(t){var e=this;this.createDagreGraph(t),u.layout(this.dagreGraph),t.edgeLabels=this.dagreGraph._edgeLabels;var n=function(t){var n=e.dagreGraph._nodes[t.id];return m({},t,{position:{x:n.x,y:n.y},dimension:{width:n.width,height:n.height}})};return t.clusters=(t.clusters||[]).map(n),t.nodes=t.nodes.map(n),t},t.prototype.updateEdge=function(t,e){var n=t.nodes.find(function(t){return t.id===e.source}),i=t.nodes.find(function(t){return t.id===e.target}),o=n.position.y<=i.position.y?-1:1,r={x:n.position.x,y:n.position.y-o*(n.dimension.height/2)},s={x:i.position.x,y:i.position.y+o*(i.dimension.height/2)};return e.points=[r,s],t},t.prototype.createDagreGraph=function(t){var e,n,i,o,r,s,a=this,d=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new u.graphlib.Graph({compound:d.compound,multigraph:d.multigraph}),this.dagreGraph.setGraph({rankdir:d.orientation,marginx:d.marginX,marginy:d.marginY,edgesep:d.edgePadding,ranksep:d.rankPadding,nodesep:d.nodePadding,align:d.align,acyclicer:d.acyclicer,ranker:d.ranker,multigraph:d.multigraph,compound:d.compound}),this.dagreGraph.setDefaultEdgeLabel(function(){return{}}),this.dagreNodes=t.nodes.map(function(t){var e=Object.assign({},t);return e.width=t.dimension.width,e.height=t.dimension.height,e.x=t.position.x,e.y=t.position.y,e}),this.dagreClusters=t.clusters||[],this.dagreEdges=t.edges.map(function(t){var e=Object.assign({},t);return e.id||(e.id=w()),e});try{for(var h=y(this.dagreNodes),p=h.next();!p.done;p=h.next()){var g=p.value;this.dagreGraph.setNode(g.id,g)}}catch(G){e={error:G}}finally{try{p&&!p.done&&(n=h["return"])&&n.call(h)}finally{if(e)throw e.error}}var c=function(t){l.dagreGraph.setNode(t.id,t),t.childNodeIds.forEach(function(e){a.dagreGraph.setParent(e,t.id)})},l=this;try{for(var f=y(this.dagreClusters),m=f.next();!m.done;m=f.next()){c(m.value)}}catch(T){i={error:T}}finally{try{m&&!m.done&&(o=f["return"])&&o.call(f)}finally{if(i)throw i.error}}try{for(var v=y(this.dagreEdges),x=v.next();!x.done;x=v.next()){var b=x.value;d.multigraph?this.dagreGraph.setEdge(b.source,b.target,b,b.id):this.dagreGraph.setEdge(b.source,b.target)}}catch(L){r={error:L}}finally{try{x&&!x.done&&(s=v["return"])&&s.call(v)}finally{if(r)throw r.error}}return this.dagreGraph},t}(),O={LEFT_TO_RIGHT:"LR",RIGHT_TO_LEFT:"RL",TOP_TO_BOTTOM:"TB",BOTTOM_TO_TOM:"BT"};function E(t){return"string"==typeof t?{id:t,x:0,y:0}:t}function k(t,e){return"number"==typeof e?t[e]:e}var M={dagre:T,dagreCluster:L,dagreNodesOnly:function(){function t(){this.defaultSettings={orientation:O.LEFT_TO_RIGHT,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,curveDistance:20,multigraph:!0,compound:!0},this.settings={}}return t.prototype.run=function(t){var e,n;this.createDagreGraph(t),u.layout(this.dagreGraph),t.edgeLabels=this.dagreGraph._edgeLabels;var i=function(e){var n=o.dagreGraph._nodes[e],i=t.nodes.find(function(t){return t.id===n.id});i.position={x:n.x,y:n.y},i.dimension={width:n.width,height:n.height}},o=this;for(var r in this.dagreGraph._nodes)i(r);try{for(var s=y(t.edges),a=s.next();!a.done;a=s.next()){var d=a.value;this.updateEdge(t,d)}}catch(h){e={error:h}}finally{try{a&&!a.done&&(n=s["return"])&&n.call(s)}finally{if(e)throw e.error}}return t},t.prototype.updateEdge=function(t,e){var n,i,o,r,s=t.nodes.find(function(t){return t.id===e.source}),a=t.nodes.find(function(t){return t.id===e.target}),d="BT"===this.settings.orientation||"TB"===this.settings.orientation?"y":"x",h="y"===d?"x":"y",u="y"===d?"height":"width",p=s.position[d]<=a.position[d]?-1:1,g=((n={})[h]=s.position[h],n[d]=s.position[d]-p*(s.dimension[u]/2),n),c=((i={})[h]=a.position[h],i[d]=a.position[d]+p*(a.dimension[u]/2),i),l=this.settings.curveDistance||this.defaultSettings.curveDistance;e.points=[g,(o={},o[h]=g[h],o[d]=g[d]-p*l,o),(r={},r[h]=c[h],r[d]=c[d]+p*l,r),c];var f=e.source+""+e.target+"\0",m=t.edgeLabels[f];return m&&(m.points=e.points),t},t.prototype.createDagreGraph=function(t){var e,n,i,o,r=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new u.graphlib.Graph({compound:r.compound,multigraph:r.multigraph}),this.dagreGraph.setGraph({rankdir:r.orientation,marginx:r.marginX,marginy:r.marginY,edgesep:r.edgePadding,ranksep:r.rankPadding,nodesep:r.nodePadding,align:r.align,acyclicer:r.acyclicer,ranker:r.ranker,multigraph:r.multigraph,compound:r.compound}),this.dagreGraph.setDefaultEdgeLabel(function(){return{}}),this.dagreNodes=t.nodes.map(function(t){var e=Object.assign({},t);return e.width=t.dimension.width,e.height=t.dimension.height,e.x=t.position.x,e.y=t.position.y,e}),this.dagreEdges=t.edges.map(function(t){var e=Object.assign({},t);return e.id||(e.id=w()),e});try{for(var s=y(this.dagreNodes),a=s.next();!a.done;a=s.next()){var d=a.value;d.width||(d.width=20),d.height||(d.height=30),this.dagreGraph.setNode(d.id,d)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(n=s["return"])&&n.call(s)}finally{if(e)throw e.error}}try{for(var h=y(this.dagreEdges),p=h.next();!p.done;p=h.next()){var g=p.value;r.multigraph?this.dagreGraph.setEdge(g.source,g.target,g,g.id):this.dagreGraph.setEdge(g.source,g.target)}}catch(l){i={error:l}}finally{try{p&&!p.done&&(o=h["return"])&&o.call(h)}finally{if(i)throw i.error}}return this.dagreGraph},t}(),d3ForceDirected:function(){function t(){this.defaultSettings={force:p.forceSimulation().force("charge",p.forceManyBody().strength(-150)).force("collide",p.forceCollide(5)),forceLink:p.forceLink().id(function(t){return t.id}).distance(function(){return 100})},this.settings={},this.outputGraph$=new a.Subject}return t.prototype.run=function(t){var e=this;return this.inputGraph=t,this.d3Graph={nodes:x(this.inputGraph.nodes.map(function(t){return m({},t)})),edges:x(this.inputGraph.edges.map(function(t){return m({},t)}))},this.outputGraph={nodes:[],edges:[],edgeLabels:[]},this.outputGraph$.next(this.outputGraph),this.settings=Object.assign({},this.defaultSettings,this.settings),this.settings.force&&this.settings.force.nodes(this.d3Graph.nodes).force("link",this.settings.forceLink.links(this.d3Graph.edges)).alpha(.5).restart().on("tick",function(){e.outputGraph$.next(e.d3GraphToOutputGraph(e.d3Graph))}),this.outputGraph$.asObservable()},t.prototype.updateEdge=function(t,e){var n=this,i=Object.assign({},this.defaultSettings,this.settings);return i.force&&i.force.nodes(this.d3Graph.nodes).force("link",i.forceLink.links(this.d3Graph.edges)).alpha(.5).restart().on("tick",function(){n.outputGraph$.next(n.d3GraphToOutputGraph(n.d3Graph))}),this.outputGraph$.asObservable()},t.prototype.d3GraphToOutputGraph=function(t){return this.outputGraph.nodes=this.d3Graph.nodes.map(function(t){return m({},t,{id:t.id||w(),position:{x:t.x,y:t.y},dimension:{width:t.dimension&&t.dimension.width||20,height:t.dimension&&t.dimension.height||20},transform:"translate("+(t.x-(t.dimension&&t.dimension.width||20)/2||0)+", "+(t.y-(t.dimension&&t.dimension.height||20)/2||0)+")"})}),this.outputGraph.edges=this.d3Graph.edges.map(function(t){return m({},t,{source:E(t.source).id,target:E(t.target).id,points:[{x:E(t.source).x,y:E(t.source).y},{x:E(t.target).x,y:E(t.target).y}]})}),this.outputGraph.edgeLabels=this.outputGraph.edges,this.outputGraph},t.prototype.onDragStart=function(t,e){this.settings.force.alphaTarget(.3).restart();var n=this.d3Graph.nodes.find(function(e){return e.id===t.id});n&&(this.draggingStart={x:e.x-n.x,y:e.y-n.y},n.fx=e.x-this.draggingStart.x,n.fy=e.y-this.draggingStart.y)},t.prototype.onDrag=function(t,e){if(t){var n=this.d3Graph.nodes.find(function(e){return e.id===t.id});n&&(n.fx=e.x-this.draggingStart.x,n.fy=e.y-this.draggingStart.y)}},t.prototype.onDragEnd=function(t,e){if(t){var n=this.d3Graph.nodes.find(function(e){return e.id===t.id});n&&(this.settings.force.alphaTarget(0),n.fx=undefined,n.fy=undefined)}},t}(),colaForceDirected:function(){function t(){this.defaultSettings={force:g.d3adaptor(m({},c,p,l)).linkDistance(150).avoidOverlaps(!0),viewDimensions:{width:600,height:600,xOffset:0}},this.settings={},this.outputGraph$=new a.Subject}return t.prototype.run=function(t){var e=this;return this.inputGraph=t,this.inputGraph.clusters||(this.inputGraph.clusters=[]),this.internalGraph={nodes:x(this.inputGraph.nodes.map(function(t){return m({},t,{width:t.dimension?t.dimension.width:20,height:t.dimension?t.dimension.height:20})})),groups:x(this.inputGraph.clusters.map(function(t){return{padding:5,groups:t.childNodeIds.map(function(t){return e.inputGraph.clusters.findIndex(function(e){return e.id===t})}).filter(function(t){return t>=0}),leaves:t.childNodeIds.map(function(t){return e.inputGraph.nodes.findIndex(function(e){return e.id===t})}).filter(function(t){return t>=0})}})),links:x(this.inputGraph.edges.map(function(t){var n=e.inputGraph.nodes.findIndex(function(e){return t.source===e.id}),i=e.inputGraph.nodes.findIndex(function(e){return t.target===e.id});return-1===n||-1===i?undefined:m({},t,{source:n,target:i})}).filter(function(t){return!!t})),groupLinks:x(this.inputGraph.edges.map(function(t){var n=e.inputGraph.nodes.findIndex(function(e){return t.source===e.id}),i=e.inputGraph.nodes.findIndex(function(e){return t.target===e.id});return n>=0&&i>=0?undefined:t}).filter(function(t){return!!t}))},this.outputGraph={nodes:[],clusters:[],edges:[],edgeLabels:[]},this.outputGraph$.next(this.outputGraph),this.settings=Object.assign({},this.defaultSettings,this.settings),this.settings.force&&(this.settings.force=this.settings.force.nodes(this.internalGraph.nodes).groups(this.internalGraph.groups).links(this.internalGraph.links).alpha(.5).on("tick",function(){e.settings.onTickListener&&e.settings.onTickListener(e.internalGraph),e.outputGraph$.next(e.internalGraphToOutputGraph(e.internalGraph))}),this.settings.viewDimensions&&(this.settings.force=this.settings.force.size([this.settings.viewDimensions.width,this.settings.viewDimensions.height])),this.settings.forceModifierFn&&(this.settings.force=this.settings.forceModifierFn(this.settings.force)),this.settings.force.start()),this.outputGraph$.asObservable()},t.prototype.updateEdge=function(t,e){var n=Object.assign({},this.defaultSettings,this.settings);return n.force&&n.force.start(),this.outputGraph$.asObservable()},t.prototype.internalGraphToOutputGraph=function(t){var e=this;return this.outputGraph.nodes=t.nodes.map(function(t){return m({},t,{id:t.id||w(),position:{x:t.x,y:t.y},dimension:{width:t.dimension&&t.dimension.width||20,height:t.dimension&&t.dimension.height||20},transform:"translate("+(t.x-(t.dimension&&t.dimension.width||20)/2||0)+", "+(t.y-(t.dimension&&t.dimension.height||20)/2||0)+")"})}),this.outputGraph.edges=t.links.map(function(e){var n=k(t.nodes,e.source),i=k(t.nodes,e.target);return m({},e,{source:n.id,target:i.id,points:[n.bounds.rayIntersection(i.bounds.cx(),i.bounds.cy()),i.bounds.rayIntersection(n.bounds.cx(),n.bounds.cy())]})}).concat(t.groupLinks.map(function(e){var n=t.nodes.find(function(t){return t.id===e.source}),i=t.nodes.find(function(t){return t.id===e.target}),o=n||t.groups.find(function(t){return t.id===e.source}),r=i||t.groups.find(function(t){return t.id===e.target});return m({},e,{source:o.id,target:r.id,points:[o.bounds.rayIntersection(r.bounds.cx(),r.bounds.cy()),r.bounds.rayIntersection(o.bounds.cx(),o.bounds.cy())]})})),this.outputGraph.clusters=t.groups.map(function(t,n){var i=e.inputGraph.clusters[n];return m({},i,{dimension:{width:t.bounds?t.bounds.width():20,height:t.bounds?t.bounds.height():20},position:{x:t.bounds?t.bounds.x+t.bounds.width()/2:0,y:t.bounds?t.bounds.y+t.bounds.height()/2:0}})}),this.outputGraph.edgeLabels=this.outputGraph.edges,this.outputGraph},t.prototype.onDragStart=function(t,e){var n=this.outputGraph.nodes.findIndex(function(e){return e.id===t.id}),i=this.internalGraph.nodes[n];i&&(this.draggingStart={x:i.x-e.x,y:i.y-e.y},i.fixed=1,this.settings.force.start())},t.prototype.onDrag=function(t,e){if(t){var n=this.outputGraph.nodes.findIndex(function(e){return e.id===t.id}),i=this.internalGraph.nodes[n];i&&(i.x=this.draggingStart.x+e.x,i.y=this.draggingStart.y+e.y)}},t.prototype.onDragEnd=function(t,e){if(t){var n=this.outputGraph.nodes.findIndex(function(e){return e.id===t.id}),i=this.internalGraph.nodes[n];i&&(i.fixed=0)}},t}()},D=function(){function t(){}return t.prototype.getLayout=function(t){if(M[t])return new M[t];throw new Error("Unknown layout type '"+t+"'")},t.decorators=[{type:e.Injectable}],t}(),I={Both:"both",Horizontal:"horizontal",Vertical:"vertical"},S=function(t){function s(n,i,o,r){var s=t.call(this,n,i,o)||this;return s.el=n,s.zone=i,s.cd=o,s.layoutService=r,s.legend=!1,s.nodes=[],s.clusters=[],s.links=[],s.activeEntries=[],s.draggingEnabled=!0,s.panningEnabled=!0,s.panningAxis=I.Both,s.enableZoom=!0,s.zoomSpeed=.1,s.minZoomLevel=.1,s.maxZoomLevel=4,s.autoZoom=!1,s.panOnZoom=!0,s.animate=!1,s.autoCenter=!1,s.activate=new e.EventEmitter,s.deactivate=new e.EventEmitter,s.zoomChange=new e.EventEmitter,s.clickHandler=new e.EventEmitter,s.isMouseMoveCalled=!1,s.graphSubscription=new a.Subscription,s.subscriptions=[],s.margin=[0,0,0,0],s.results=[],s.isPanning=!1,s.isDragging=!1,s.initialized=!1,s.graphDims={width:0,height:0},s._oldLinks=[],s.oldNodes=new Set,s.transformationMatrix=h.identity(),s._touchLastX=null,s._touchLastY=null,s.groupResultsBy=function(t){return t.label},s}return function(t,e){function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(s,t),Object.defineProperty(s.prototype,"zoomLevel",{get:function(){return this.transformationMatrix.a},set:function(t){this.zoomTo(Number(t))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"panOffsetX",{get:function(){return this.transformationMatrix.e},set:function(t){this.panTo(Number(t),null)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"panOffsetY",{get:function(){return this.transformationMatrix.f},set:function(t){this.panTo(null,Number(t))},enumerable:!0,configurable:!0}),s.prototype.ngOnInit=function(){var t=this;this.update$&&this.subscriptions.push(this.update$.subscribe(function(){t.update()})),this.center$&&this.subscriptions.push(this.center$.subscribe(function(){t.center()})),this.zoomToFit$&&this.subscriptions.push(this.zoomToFit$.subscribe(function(){t.zoomToFit()})),this.panToNode$&&this.subscriptions.push(this.panToNode$.subscribe(function(e){t.panToNodeId(e)}))},s.prototype.ngOnChanges=function(t){t.layout;var e=t.layoutSettings;t.nodes,t.clusters,t.links;this.setLayout(this.layout),e&&this.setLayoutSettings(this.layoutSettings),this.update()},s.prototype.setLayout=function(t){this.initialized=!1,t||(t="dagre"),"string"==typeof t&&(this.layout=this.layoutService.getLayout(t),this.setLayoutSettings(this.layoutSettings))},s.prototype.setLayoutSettings=function(t){this.layout&&"string"!=typeof this.layout&&(this.layout.settings=t,this.update())},s.prototype.ngOnDestroy=function(){var e,n;t.prototype.ngOnDestroy.call(this);try{for(var i=y(this.subscriptions),o=i.next();!o.done;o=i.next()){o.value.unsubscribe()}}catch(r){e={error:r}}finally{try{o&&!o.done&&(n=i["return"])&&n.call(i)}finally{if(e)throw e.error}}this.subscriptions=null},s.prototype.ngAfterViewInit=function(){var e=this;t.prototype.ngAfterViewInit.call(this),setTimeout(function(){return e.update()})},s.prototype.update=function(){var e=this;t.prototype.update.call(this),this.curve||(this.curve=o.curveBundle.beta(1)),this.zone.run(function(){e.dims=n.calculateViewDimensions({width:e.width,height:e.height,margins:e.margin,showLegend:e.legend}),e.seriesDomain=e.getSeriesDomain(),e.setColors(),e.legendOptions=e.getLegendOptions(),e.createGraph(),e.updateTransform(),e.initialized=!0})},s.prototype.createGraph=function(){var t=this;this.graphSubscription.unsubscribe(),this.graphSubscription=new a.Subscription;var e=function(e){return e.meta||(e.meta={}),e.id||(e.id=w()),e.dimension?e.meta.forceDimensions=e.meta.forceDimensions===undefined||e.meta.forceDimensions:(e.dimension={width:t.nodeWidth?t.nodeWidth:30,height:t.nodeHeight?t.nodeHeight:30},e.meta.forceDimensions=!1),e.position={x:0,y:0},e.data=e.data?e.data:{},e};this.graph={nodes:x(this.nodes).map(e),clusters:x(this.clusters||[]).map(e),edges:x(this.links).map(function(t){return t.id||(t.id=w()),t})},requestAnimationFrame(function(){return t.draw()})},s.prototype.draw=function(){var t=this;if(this.layout&&"string"!=typeof this.layout){this.applyNodeDimensions();var e=this.layout.run(this.graph),n=e instanceof a.Observable?e:a.of(e);this.graphSubscription.add(n.subscribe(function(e){t.graph=e,t.tick()})),n.pipe(d.first(function(t){return t.nodes.length>0})).subscribe(function(){return t.applyNodeDimensions()})}},s.prototype.tick=function(){var t=this,e=new Set;this.graph.nodes.map(function(n){n.transform="translate("+(n.position.x-n.dimension.width/2||0)+", "+(n.position.y-n.dimension.height/2||0)+")",n.data||(n.data={}),n.data.color=t.colors.getColor(t.groupResultsBy(n)),e.add(n.id)}),setTimeout(function(){t.oldNodes=e},500),(this.graph.clusters||[]).map(function(e){e.transform="translate("+(e.position.x-e.dimension.width/2||0)+", "+(e.position.y-e.dimension.height/2||0)+")",e.data||(e.data={}),e.data.color=t.colors.getColor(t.groupResultsBy(e))});var n=[],i=function(t){var e=o.graph.edgeLabels[t],i=t.replace(/[^\w-]*/g,""),r=o.layout&&"string"!=typeof o.layout&&o.layout.settings&&o.layout.settings.multigraph,s=r?o._oldLinks.find(function(t){return""+t.source+t.target+t.id===i}):o._oldLinks.find(function(t){return""+t.source+t.target===i}),a=r?o.graph.edges.find(function(t){return""+t.source+t.target+t.id===i}):o.graph.edges.find(function(t){return""+t.source+t.target===i});s?s.data&&a&&a.data&&JSON.stringify(s.data)!==JSON.stringify(a.data)&&(s.data=a.data):s=a||e,s.oldLine=s.line;var d=e.points,h=o.generateLine(d),u=Object.assign({},s);u.line=h,u.points=d,o.updateMidpointOnEdge(u,d);var p=d[Math.floor(d.length/2)];p&&(u.textTransform="translate("+(p.x||0)+","+(p.y||0)+")"),u.textAngle=0,u.oldLine||(u.oldLine=u.line),o.calcDominantBaseline(u),n.push(u)},o=this;for(var r in this.graph.edgeLabels)i(r);this.graph.edges=n,this.graph.edges&&(this._oldLinks=this.graph.edges.map(function(t){var e=Object.assign({},t);return e.oldLine=t.line,e})),this.graph.nodes&&this.graph.nodes.length&&(this.graphDims.width=Math.max.apply(Math,x(this.graph.nodes.map(function(t){return t.position.x+t.dimension.width}))),this.graphDims.height=Math.max.apply(Math,x(this.graph.nodes.map(function(t){return t.position.y+t.dimension.height})))),this.autoZoom&&this.zoomToFit(),this.autoCenter&&this.center(),requestAnimationFrame(function(){return t.redrawLines()}),this.cd.markForCheck()},s.prototype.applyNodeDimensions=function(){var t=this;this.nodeElements&&this.nodeElements.length&&this.nodeElements.map(function(e){var n,i,o,r=e.nativeElement,s=t.graph.nodes.find(function(t){return t.id===r.id});try{o=r.getBBox()}catch(p){return}if(t.nodeHeight?s.dimension.height=s.dimension.height&&s.meta.forceDimensions?s.dimension.height:t.nodeHeight:s.dimension.height=s.dimension.height&&s.meta.forceDimensions?s.dimension.height:o.height,t.nodeMaxHeight&&(s.dimension.height=Math.max(s.dimension.height,t.nodeMaxHeight)),t.nodeMinHeight&&(s.dimension.height=Math.min(s.dimension.height,t.nodeMinHeight)),t.nodeWidth)s.dimension.width=s.dimension.width&&s.meta.forceDimensions?s.dimension.width:t.nodeWidth;else if(r.getElementsByTagName("text").length){var a=void 0;try{try{for(var d=y(r.getElementsByTagName("text")),h=d.next();!h.done;h=d.next()){var u=h.value.getBBox();a?(u.width>a.width&&(a.width=u.width),u.height>a.height&&(a.height=u.height)):a=u}}catch(g){n={error:g}}finally{try{h&&!h.done&&(i=d["return"])&&i.call(d)}finally{if(n)throw n.error}}}catch(p){return}s.dimension.width=s.dimension.width&&s.meta.forceDimensions?s.dimension.width:a.width+20}else s.dimension.width=s.dimension.width&&s.meta.forceDimensions?s.dimension.width:o.width;t.nodeMaxWidth&&(s.dimension.width=Math.max(s.dimension.width,t.nodeMaxWidth)),t.nodeMinWidth&&(s.dimension.width=Math.min(s.dimension.width,t.nodeMinWidth))})},s.prototype.redrawLines=function(t){var e=this;void 0===t&&(t=this.animate),this.linkElements.map(function(n){var o=e.graph.edges.find(function(t){return t.id===n.nativeElement.id});o&&(i.select(n.nativeElement).select(".line").attr("d",o.oldLine).transition().ease(r.easeSinInOut).duration(t?500:0).attr("d",o.line),i.select(e.chartElement.nativeElement).select("#"+o.id).attr("d",o.oldTextPath).transition().ease(r.easeSinInOut).duration(t?500:0).attr("d",o.textPath),e.updateMidpointOnEdge(o,o.points))})},s.prototype.calcDominantBaseline=function(t){var e=t.points[0],n=t.points[t.points.length-1];t.oldTextPath=t.textPath,n.x<e.x?(t.dominantBaseline="text-before-edge",t.textPath=this.generateLine(x(t.points).reverse())):(t.dominantBaseline="text-after-edge",t.textPath=t.line)},s.prototype.generateLine=function(t){return o.line().x(function(t){return t.x}).y(function(t){return t.y}).curve(this.curve)(t)},s.prototype.onZoom=function(t,e){var n=1+("in"===e?this.zoomSpeed:-this.zoomSpeed),i=this.zoomLevel*n;if(!(i<=this.minZoomLevel||i>=this.maxZoomLevel)&&this.enableZoom)if(!0===this.panOnZoom&&t){var o=t.clientX,r=t.clientY,s=this.chart.nativeElement.querySelector("svg"),a=s.querySelector("g.chart"),d=s.createSVGPoint();d.x=o,d.y=r;var h=d.matrixTransform(a.getScreenCTM().inverse());this.pan(h.x,h.y,!0),this.zoom(n),this.pan(-h.x,-h.y,!0)}else this.zoom(n)},s.prototype.pan=function(t,e,n){void 0===n&&(n=!1);var i=n?1:this.zoomLevel;this.transformationMatrix=h.transform(this.transformationMatrix,h.translate(t/i,e/i)),this.updateTransform()},s.prototype.panTo=function(t,e){if(null!==t&&t!==undefined&&!isNaN(t)&&null!==e&&e!==undefined&&!isNaN(e)){var n=-this.panOffsetX-t*this.zoomLevel+this.dims.width/2,i=-this.panOffsetY-e*this.zoomLevel+this.dims.height/2;this.transformationMatrix=h.transform(this.transformationMatrix,h.translate(n/this.zoomLevel,i/this.zoomLevel)),this.updateTransform()}},s.prototype.zoom=function(t){this.transformationMatrix=h.transform(this.transformationMatrix,h.scale(t,t)),this.zoomChange.emit(this.zoomLevel),this.updateTransform()},s.prototype.zoomTo=function(t){this.transformationMatrix.a=isNaN(t)?this.transformationMatrix.a:Number(t),this.transformationMatrix.d=isNaN(t)?this.transformationMatrix.d:Number(t),this.zoomChange.emit(this.zoomLevel),this.updateTransform(),this.update()},s.prototype.onPan=function(t){this.pan(t.movementX,t.movementY)},s.prototype.onDrag=function(t){var e,n,i=this;if(this.draggingEnabled){var o=this.draggingNode;this.layout&&"string"!=typeof this.layout&&this.layout.onDrag&&this.layout.onDrag(o,t),o.position.x+=t.movementX/this.zoomLevel,o.position.y+=t.movementY/this.zoomLevel;var r=o.position.x-o.dimension.width/2,s=o.position.y-o.dimension.height/2;o.transform="translate("+r+", "+s+")";var d=function(t){if((t.target===o.id||t.source===o.id||t.target.id===o.id||t.source.id===o.id)&&h.layout&&"string"!=typeof h.layout){var e=h.layout.updateEdge(h.graph,t),n=e instanceof a.Observable?e:a.of(e);h.graphSubscription.add(n.subscribe(function(e){i.graph=e,i.redrawEdge(t)}))}},h=this;try{for(var u=y(this.graph.edges),p=u.next();!p.done;p=u.next()){d(p.value)}}catch(g){e={error:g}}finally{try{p&&!p.done&&(n=u["return"])&&n.call(u)}finally{if(e)throw e.error}}this.redrawLines(!1)}},s.prototype.redrawEdge=function(t){var e=this.generateLine(t.points);this.calcDominantBaseline(t),t.oldLine=t.line,t.line=e},s.prototype.updateTransform=function(){this.transform=h.toSVG(h.smoothMatrix(this.transformationMatrix,100))},s.prototype.onClick=function(t){this.select.emit(t)},s.prototype.onActivate=function(t){this.activeEntries.indexOf(t)>-1||(this.activeEntries=x([t],this.activeEntries),this.activate.emit({value:t,entries:this.activeEntries}))},s.prototype.onDeactivate=function(t){var e=this.activeEntries.indexOf(t);this.activeEntries.splice(e,1),this.activeEntries=x(this.activeEntries),this.deactivate.emit({value:t,entries:this.activeEntries})},s.prototype.getSeriesDomain=function(){var t=this;return this.nodes.map(function(e){return t.groupResultsBy(e)}).reduce(function(t,e){return-1!==t.indexOf(e)?t:t.concat([e])},[]).sort()},s.prototype.trackLinkBy=function(t,e){return e.id},s.prototype.trackNodeBy=function(t,e){return e.id},s.prototype.setColors=function(){this.colors=new n.ColorHelper(this.scheme,"ordinal",this.seriesDomain,this.customColors)},s.prototype.getLegendOptions=function(){return{scaleType:"ordinal",domain:this.seriesDomain,colors:this.colors}},s.prototype.onMouseMove=function(t){this.isMouseMoveCalled=!0,this.isPanning&&this.panningEnabled?this.checkEnum(this.panningAxis,t):this.isDragging&&this.draggingEnabled&&this.onDrag(t)},s.prototype.onMouseDown=function(t){this.isMouseMoveCalled=!1},s.prototype.graphClick=function(t){this.isMouseMoveCalled||this.clickHandler.emit(t)},s.prototype.onTouchStart=function(t){this._touchLastX=t.changedTouches[0].clientX,this._touchLastY=t.changedTouches[0].clientY,this.isPanning=!0},s.prototype.onTouchMove=function(t){if(this.isPanning&&this.panningEnabled){var e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY,i=e-this._touchLastX,o=n-this._touchLastY;this._touchLastX=e,this._touchLastY=n,this.pan(i,o)}},s.prototype.onTouchEnd=function(t){this.isPanning=!1},s.prototype.onMouseUp=function(t){this.isDragging=!1,this.isPanning=!1,this.layout&&"string"!=typeof this.layout&&this.layout.onDragEnd&&this.layout.onDragEnd(this.draggingNode,t)},s.prototype.onNodeMouseDown=function(t,e){this.draggingEnabled&&(this.isDragging=!0,this.draggingNode=e,this.layout&&"string"!=typeof this.layout&&this.layout.onDragStart&&this.layout.onDragStart(e,t))},s.prototype.center=function(){this.panTo(this.graphDims.width/2,this.graphDims.height/2)},s.prototype.zoomToFit=function(){var t=this.dims.height/this.graphDims.height,e=this.dims.width/this.graphDims.width,n=Math.min(t,e,1);n<=this.minZoomLevel||n>=this.maxZoomLevel||n!==this.zoomLevel&&(this.zoomLevel=n,this.updateTransform(),this.zoomChange.emit(this.zoomLevel))},s.prototype.panToNodeId=function(t){var e=this.nodes.find(function(e){return e.id===t});e&&this.panTo(e.position.x,e.position.y)},s.prototype.checkEnum=function(t,e){switch(t){case I.Horizontal:this.pan(e.movementX,0);break;case I.Vertical:this.pan(0,e.movementY);break;default:this.onPan(e)}},s.prototype.updateMidpointOnEdge=function(t,e){if(t&&e)if(e.length%2==1)t.midPoint=e[Math.floor(e.length/2)];else{var n=e[e.length/2],i=e[e.length/2-1];t.midPoint={x:(n.x+i.x)/2,y:(n.y+i.y)/2}}},s.decorators=[{type:e.Component,args:[{selector:"ngx-graph",template:'<ngx-charts-chart\n  [view]="[width, height]"\n  [showLegend]="legend"\n  [legendOptions]="legendOptions"\n  (legendLabelClick)="onClick($event)"\n  (legendLabelActivate)="onActivate($event)"\n  (legendLabelDeactivate)="onDeactivate($event)"\n  mouseWheel\n  (mouseWheelUp)="onZoom($event, \'in\')"\n  (mouseWheelDown)="onZoom($event, \'out\')"\n>\n  <svg:g\n    *ngIf="initialized && graph"\n    [attr.transform]="transform"\n    (touchstart)="onTouchStart($event)"\n    (touchend)="onTouchEnd($event)"\n    class="graph chart"\n  >\n    <defs>\n      <ng-template *ngIf="defsTemplate" [ngTemplateOutlet]="defsTemplate"></ng-template>\n      <svg:path\n        class="text-path"\n        *ngFor="let link of graph.edges"\n        [attr.d]="link.textPath"\n        [attr.id]="link.id"\n      ></svg:path>\n    </defs>\n\n    <svg:rect\n      class="panning-rect"\n      [attr.width]="dims.width * 100"\n      [attr.height]="dims.height * 100"\n      [attr.transform]="\'translate(\' + (-dims.width || 0) * 50 + \',\' + (-dims.height || 0) * 50 + \')\'"\n      (mousedown)="isPanning = true"\n    />\n\n    <ng-content></ng-content>\n\n    <svg:g class="clusters">\n      <svg:g\n        #clusterElement\n        *ngFor="let node of graph.clusters; trackBy: trackNodeBy"\n        class="node-group"\n        [id]="node.id"\n        [attr.transform]="node.transform"\n        (click)="onClick(node)"\n      >\n        <ng-template\n          *ngIf="clusterTemplate"\n          [ngTemplateOutlet]="clusterTemplate"\n          [ngTemplateOutletContext]="{ $implicit: node }"\n        ></ng-template>\n        <svg:g *ngIf="!clusterTemplate" class="node cluster">\n          <svg:rect\n            [attr.width]="node.dimension.width"\n            [attr.height]="node.dimension.height"\n            [attr.fill]="node.data?.color"\n          />\n          <svg:text alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height / 2">\n            {{ node.label }}\n          </svg:text>\n        </svg:g>\n      </svg:g>\n    </svg:g>\n\n    <svg:g class="links">\n      <svg:g #linkElement *ngFor="let link of graph.edges; trackBy: trackLinkBy" class="link-group" [id]="link.id">\n        <ng-template\n          *ngIf="linkTemplate"\n          [ngTemplateOutlet]="linkTemplate"\n          [ngTemplateOutletContext]="{ $implicit: link }"\n        ></ng-template>\n        <svg:path *ngIf="!linkTemplate" class="edge" [attr.d]="link.line" />\n      </svg:g>\n    </svg:g>\n\n    <svg:g class="nodes">\n      <svg:g\n        #nodeElement\n        *ngFor="let node of graph.nodes; trackBy: trackNodeBy"\n        class="node-group"\n        [class.old-node]="animate && oldNodes.has(node.id)"\n        [id]="node.id"\n        [attr.transform]="node.transform"\n        (click)="onClick(node)"\n        (mousedown)="onNodeMouseDown($event, node)"\n      >\n        <ng-template\n          *ngIf="nodeTemplate"\n          [ngTemplateOutlet]="nodeTemplate"\n          [ngTemplateOutletContext]="{ $implicit: node }"\n        ></ng-template>\n        <svg:circle\n          *ngIf="!nodeTemplate"\n          r="10"\n          [attr.cx]="node.dimension.width / 2"\n          [attr.cy]="node.dimension.height / 2"\n          [attr.fill]="node.data?.color"\n        />\n      </svg:g>\n    </svg:g>\n  </svg:g>\n</ngx-charts-chart>\n',encapsulation:e.ViewEncapsulation.None,changeDetection:e.ChangeDetectionStrategy.OnPush,styles:[".graph{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.graph .edge{stroke:#666;fill:none}.graph .edge .edge-label{stroke:none;font-size:12px;fill:#251e1e}.graph .panning-rect{fill:transparent;cursor:move}.graph .node-group.old-node{transition:transform .5s ease-in-out;transition:transform .5s ease-in-out,-webkit-transform .5s ease-in-out}.graph .node-group .node:focus{outline:0}.graph .cluster rect{opacity:.2}"]}]}],s.ctorParameters=function(){return[{type:e.ElementRef},{type:e.NgZone},{type:e.ChangeDetectorRef},{type:D}]},s.propDecorators={legend:[{type:e.Input}],nodes:[{type:e.Input}],clusters:[{type:e.Input}],links:[{type:e.Input}],activeEntries:[{type:e.Input}],curve:[{type:e.Input}],draggingEnabled:[{type:e.Input}],nodeHeight:[{type:e.Input}],nodeMaxHeight:[{type:e.Input}],nodeMinHeight:[{type:e.Input}],nodeWidth:[{type:e.Input}],nodeMinWidth:[{type:e.Input}],nodeMaxWidth:[{type:e.Input}],panningEnabled:[{type:e.Input}],panningAxis:[{type:e.Input}],enableZoom:[{type:e.Input}],zoomSpeed:[{type:e.Input}],minZoomLevel:[{type:e.Input}],maxZoomLevel:[{type:e.Input}],autoZoom:[{type:e.Input}],panOnZoom:[{type:e.Input}],animate:[{type:e.Input}],autoCenter:[{type:e.Input}],update$:[{type:e.Input}],center$:[{type:e.Input}],zoomToFit$:[{type:e.Input}],panToNode$:[{type:e.Input}],layout:[{type:e.Input}],layoutSettings:[{type:e.Input}],activate:[{type:e.Output}],deactivate:[{type:e.Output}],zoomChange:[{type:e.Output}],clickHandler:[{type:e.Output}],linkTemplate:[{type:e.ContentChild,args:["linkTemplate",{"static":!1}]}],nodeTemplate:[{type:e.ContentChild,args:["nodeTemplate",{"static":!1}]}],clusterTemplate:[{type:e.ContentChild,args:["clusterTemplate",{"static":!1}]}],defsTemplate:[{type:e.ContentChild,args:["defsTemplate",{"static":!1}]}],chart:[{type:e.ViewChild,args:[n.ChartComponent,{read:e.ElementRef,"static":!0}]}],nodeElements:[{type:e.ViewChildren,args:["nodeElement"]}],linkElements:[{type:e.ViewChildren,args:["linkElement"]}],groupResultsBy:[{type:e.Input}],zoomLevel:[{type:e.Input,args:["zoomLevel"]}],panOffsetX:[{type:e.Input,args:["panOffsetX"]}],panOffsetY:[{type:e.Input,args:["panOffsetY"]}],onMouseMove:[{type:e.HostListener,args:["document:mousemove",["$event"]]}],onMouseDown:[{type:e.HostListener,args:["document:mousedown",["$event"]]}],graphClick:[{type:e.HostListener,args:["document:click",["$event"]]}],onTouchMove:[{type:e.HostListener,args:["document:touchmove",["$event"]]}],onMouseUp:[{type:e.HostListener,args:["document:mouseup",["$event"]]}]},s}(n.BaseChartComponent),C=function(){function t(){this.mouseWheelUp=new e.EventEmitter,this.mouseWheelDown=new e.EventEmitter}return t.prototype.onMouseWheelChrome=function(t){this.mouseWheelFunc(t)},t.prototype.onMouseWheelFirefox=function(t){this.mouseWheelFunc(t)},t.prototype.onMouseWheelIE=function(t){this.mouseWheelFunc(t)},t.prototype.mouseWheelFunc=function(t){window.event&&(t=window.event);var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));e>0?this.mouseWheelUp.emit(t):e<0&&this.mouseWheelDown.emit(t),t.returnValue=!1,t.preventDefault&&t.preventDefault()},t.decorators=[{type:e.Directive,args:[{selector:"[mouseWheel]"}]}],t.propDecorators={mouseWheelUp:[{type:e.Output}],mouseWheelDown:[{type:e.Output}],onMouseWheelChrome:[{type:e.HostListener,args:["mousewheel",["$event"]]}],onMouseWheelFirefox:[{type:e.HostListener,args:["DOMMouseScroll",["$event"]]}],onMouseWheelIE:[{type:e.HostListener,args:["onmousewheel",["$event"]]}]},t}(),N=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[n.ChartCommonModule],declarations:[S,C],exports:[S,C],providers:[D]}]}],t}(),_=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[n.NgxChartsModule],exports:[N]}]}],t}();t.GraphComponent=S,t.NgxGraphModule=_,t.ɵa=N,t.ɵb=D,t.ɵc=C,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=swimlane-ngx-graph.umd.min.js.map